# 한국 주식 정보 조회 프로그램

이 프로그램은 한국 주식 시장의 실시간 주식 정보를 조회하는 Python 애플리케이션입니다.

## 주요 기능

- **실시간 주식 정보 조회**: 종목명으로 주식 정보를 조회
- **스마트 날짜 계산**: 주말, 공휴일, 장 마감 시간을 고려한 자동 날짜 계산
- **성능 최적화**: 종목 코드 캐싱으로 반복 조회 시 성능 향상
- **포괄적인 주식 데이터**: 시가, 고가, 저가, 종가, 거래량, 등락률 제공
- **강화된 에러 처리**: 상세한 로깅과 예외 처리
- **유사 종목 추천**: 정확한 종목명을 찾지 못할 때 유사한 종목들을 추천

## 설치 방법

```bash
pip install pykrx
```

## 사용법

### 기본 사용법

```python
from 01 import get_korean_stock_info

# 삼성전자 주식 정보 조회
result = get_korean_stock_info("삼성전자")
```

### 실행 결과 예시

```
[삼성전자] 20250620 기준
종가: 59,500원
전일대비: 0.51%
거래량: 17,184,801주
시가: 59,400원
고가: 59,800원
저가: 59,100원
```

### 유사 종목 추천 기능

정확한 종목명을 입력하지 않았을 때 유사한 종목들을 추천합니다:

```
종목명 '삼성'을 찾을 수 없습니다.
유사한 종목들을 찾았습니다:
--------------------------------------------------
1. 삼성공조 (유사도: 66.7%)
2. 삼성물산 (유사도: 66.7%)
3. 삼성생명 (유사도: 66.7%)
4. 삼성전기 (유사도: 66.7%)
5. 삼성전자 (유사도: 66.7%)
--------------------------------------------------
위 종목 중 하나를 선택하여 다시 시도해주세요.

가장 유사한 종목: 삼성공조 (코드: 006660)
```

## 주요 개선 사항

### 1. 로직 오류 수정
- `get_target_stock_date` 함수에서 잘못된 변수 사용 수정
- 매개변수로 받은 `today`를 올바르게 사용하도록 개선

### 2. 성능 최적화
- 종목 코드 캐싱 시스템 도입
- 종목명 캐싱 시스템 추가
- 반복 조회 시 네트워크 요청 최소화

### 3. 코드 구조 개선
- 타입 힌트 추가로 코드 가독성 향상
- 상수 정의로 매직 넘버 제거
- 함수 분리로 단일 책임 원칙 적용

### 4. 에러 처리 강화
- 구체적인 예외 처리
- 로깅 시스템 도입
- 사용자 친화적인 에러 메시지

### 5. 데이터 포맷팅 개선
- 시가, 고가, 저가 정보 추가
- 소수점 자릿수 통일 (등락률 2자리)
- 천 단위 구분자 적용

### 6. 유사 종목 추천 기능
- 문자열 유사도 알고리즘 사용
- 30% 이상 유사한 종목들을 추천
- 유사도 점수와 함께 표시

## API 함수 설명

### `get_target_stock_date(today: datetime) -> datetime`
주어진 날짜를 기준으로 주식 데이터를 조회할 대상 날짜를 계산합니다.

**매개변수:**
- `today`: 기준 날짜

**반환값:**
- 조회할 대상 날짜

### `calculate_similarity(str1: str, str2: str) -> float`
두 문자열의 유사도를 계산합니다.

**매개변수:**
- `str1`: 첫 번째 문자열
- `str2`: 두 번째 문자열

**반환값:**
- 유사도 점수 (0.0 ~ 1.0)

### `find_similar_stocks(target_name: str, all_stocks: List[Tuple[str, str]], limit: int = 5) -> List[Tuple[str, str, float]]`
대상 종목명과 유사한 종목들을 찾습니다.

**매개변수:**
- `target_name`: 찾고자 하는 종목명
- `all_stocks`: 모든 종목 리스트 (종목코드, 종목명)
- `limit`: 반환할 유사 종목 개수

**반환값:**
- 유사 종목 리스트 (종목코드, 종목명, 유사도)

### `get_all_stock_names() -> List[Tuple[str, str]]`
모든 종목의 코드와 이름을 가져옵니다.

**반환값:**
- 종목 리스트 (종목코드, 종목명)

### `get_stock_code_by_name(name: str) -> str`
종목명으로 종목 코드를 조회합니다. 캐시를 사용하여 성능을 개선하고, 종목을 찾지 못한 경우 유사한 종목을 추천합니다.

**매개변수:**
- `name`: 종목명

**반환값:**
- 종목 코드

### `get_korean_stock_info(stock_name: str) -> Optional[str]`
한국 주식 정보를 조회합니다.

**매개변수:**
- `stock_name`: 조회할 종목명

**반환값:**
- 포맷팅된 주식 정보 문자열 또는 None (오류 시)

### `clear_stock_cache() -> None`
종목 코드 캐시를 초기화합니다.

## 날짜 계산 로직

프로그램은 다음과 같은 규칙으로 조회 날짜를 자동 계산합니다:

- **월요일 + 마감 전 (15시 이전)**: 금요일 데이터 조회
- **화~금 + 마감 전 (15시 이전)**: 전일 데이터 조회
- **월~금 + 마감 후 (15시 이후)**: 당일 데이터 조회
- **토요일**: 금요일 데이터 조회
- **일요일**: 금요일 데이터 조회

## 유사 종목 추천 알고리즘

프로그램은 `difflib.SequenceMatcher`를 사용하여 문자열 유사도를 계산합니다:

1. **유사도 계산**: 입력된 종목명과 모든 상장 종목명 간의 유사도를 계산
2. **필터링**: 30% 이상 유사한 종목들만 선별
3. **정렬**: 유사도가 높은 순으로 정렬
4. **추천**: 상위 5개 종목을 사용자에게 제시

## 주의사항

1. **인터넷 연결**: 실시간 데이터 조회를 위해 인터넷 연결이 필요합니다.
2. **장 운영 시간**: 주말이나 공휴일에는 최근 거래일 데이터를 조회합니다.
3. **종목명 정확성**: 정확한 종목명을 입력해야 합니다 (예: "삼성전자", "SK하이닉스").
4. **유사 종목 추천**: 정확한 종목명을 모를 때는 유사한 종목들이 추천되므로, 원하는 종목을 선택하여 다시 시도하세요.

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 